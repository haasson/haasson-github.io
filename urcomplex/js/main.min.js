"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function t(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}window.onload=function(){function e(){var n=document.querySelector(".process__active"),o=document.querySelectorAll(".license-calc__item");o.forEach(function(t,e,i){t.classList.remove("license-calc__item_active","license-calc__item_active-pulse");var s=e/o.length*100;setTimeout(function(){i[e-1]&&i[e-1].classList.remove("license-calc__item_active-pulse"),t.classList.add("license-calc__item_active","license-calc__item_active-pulse"),n.style.width="".concat(s,"%")},3e3*e),e===o.length-1&&setTimeout(function(){a("#after-quiz")},3e3*e+5e3)})}new Swiper(".license__slider",{breakpoints:{1200:{slidesPerView:4},768:{slidesPerView:3},480:{slidesPerView:2}},slidesPerView:1,spaceBetween:30,pagination:{el:".swiper-pagination",clickable:!0}}),$(".license .popup-gallery").magnificPopup({type:"image",tLoading:"Loading image #%curr%...",mainClass:"custom-mfp",fixedContentPos:!0,fixedBgPos:!0,showCloseBtn:!0,delegate:".license__image",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image #%curr%</a> could not be loaded.'}}),$(".popup-with-form").magnificPopup({type:"inline",preloader:!1,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,mainClass:"custom-mfp",callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(t){t.preventDefault(),$.magnificPopup.close()})},change:function(){window.scrollTo(0,n(this.container[0]).top),"#policy"!==this.currItem.src&&(this.prevPopup=this.popupName,this.popupName=this.currItem.src)},beforeClose:function(){var t=this;"#policy"===this.currItem.src&&setTimeout(function(){a(t.popupName)},0),"#consult"===this.currItem.src&&"#quiz-block"===this.prevPopup&&setTimeout(function(){a(t.prevPopup)},0)}}}),ymaps.ready(function(){var t=new ymaps.Map("map-1",{center:[55.76713,37.6],zoom:17,behaviors:["drag"],controls:["zoomControl"]});document.documentElement.clientWidth<=992&&(t.behaviors.disable("drag"),t.behaviors.enable("multiTouch")),document.documentElement.clientWidth<=768&&t.setCenter([55.76713,37.60269]);var e=new ymaps.Placemark([55.76693,37.6022],{hintContent:"ЮрКомплекс Сити"},{iconLayout:"default#image",iconImageHref:"svg/single/placemark.svg",iconImageSize:[185,136],iconImageOffset:[-92,-40]});t.geoObjects.add(e)}),ouibounce(null,{aggressive:!0,callback:function(){a("#exit")}}),r.quiz=new o({quizSelector:"#quiz-block",extraBlocksClass:".advice__item",onFinish:function(){var t="#".concat(this.form.getAttribute("data-route"));setTimeout(function(){a(t,{open:e})},210)}});var t={phone:{type:"tel"},email:{pattern:/.+@.+\..+/i,type:"email"},name:{pattern:/^[а-яА-Я\s]{2,23}|[a-zA-Z\s]{2,30}$/,type:"text"}};new c({formID:"form-consult",inputs:t}),new c({formID:"form-exit",inputs:t}),new c({formID:"quiz-form-final",inputs:t}),new c({formID:"take-bonus-form",inputs:t}),console.log(r.quiz),$(".phone").mask("+7 999 999 9999",{autoclear:!1})};var r={};function a(t,e){var i;$.magnificPopup.open({type:"inline",mainClass:"custom-mfp",items:{src:t},preloader:!0,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(t){t.preventDefault(),$.magnificPopup.close()}),e&&e.open&&e.open()},change:function(){window.scrollTo(0,n(this.container[0]).top),"#policy"!==this.currItem.src&&(i=this.currItem.src)},beforeClose:function(){var t=this;"#policy"===this.currItem.src&&setTimeout(function(){a(i)},0),this.currItem&&"#consult"===this.currItem.src&&"quiz-block"===this.popupName&&setTimeout(function(){quiz.openPopup(t.popupName)},0)}}},0)}function n(t){var e=t.getBoundingClientRect();return{top:e.top+window.pageYOffset,left:e.left+window.pageXOffset}}var o=function(){function e(t){i(this,e),this.quiz=document.querySelector("".concat(t.quizSelector)),this.inPopup=t.inPopup,this.form=this.quiz.querySelector("form"),this.steps=this.quiz.querySelectorAll(".questions__item"),this.progressBar=this.quiz.querySelector(".questions__progress"),this.countCurrent=this.quiz.querySelector(".progress__count"),this.countTotal=this.quiz.querySelector(".progress__total"),this.prevBtn=this.quiz.querySelector(".questions__btn_prev"),this.nextBtn=this.quiz.querySelector(".questions__btn_next"),this.step=0,this.quizLength=this.steps.length,this.extraBlocks=this.quiz.querySelectorAll("".concat(t.extraBlocksClass)),this.finalForm=document.querySelector("#quiz-form-final"),this.takeBonusForm=document.querySelector("#take-bonus-form"),this.onFinish=t.onFinish,this.run()}return t(e,[{key:"run",value:function(){this.setEvents(),this.setStep(this.step)}},{key:"setEvents",value:function(){this.prevBtn.addEventListener("click",this.clickBtn.bind(this)),this.nextBtn.addEventListener("click",this.clickBtn.bind(this))}},{key:"clickBtn",value:function(t){t.target.classList.contains("questions__btn_prev")?this.setStep(this.step-1):this.setStep(this.step+1,t)}},{key:"setStep",value:function(t,e){if(t>this.quizLength-1)return this.collectData(e),void this.setStep(0);this.step=t,this.showSlide(),this.setCount(),this.progressBar&&this.actualizeProgressBar(),this.extraBlocks.length&&this.showExtraBlock(),0!==t&&this.scrollTop()}},{key:"showSlide",value:function(){var e=this;this.steps.forEach(function(t){t.classList.contains("questions__item_".concat(e.step+1))?t.classList.remove("hide"):t.classList.add("hide")}),0===this.step?this.prevBtn.classList.add("hide"):this.prevBtn.classList.remove("hide")}},{key:"setCount",value:function(){this.totalSet||(this.countTotal.innerHTML=this.quizLength,this.totalSet=!0),this.countCurrent.innerHTML=this.step+1}},{key:"scrollTop",value:function(){var t=this.getCoords(this.progressBar).top;document.documentElement.clientWidth<=992&&window.scrollTo(0,t-30)}},{key:"getCoords",value:function(t){var e=t.getBoundingClientRect();return{top:e.top+window.pageYOffset,left:e.left+window.pageXOffset}}},{key:"actualizeProgressBar",value:function(){var t=this.progressBar.querySelector(".progress__active"),e=(this.step+1)/this.steps.length*100;t.style.width="".concat(e,"%")}},{key:"showExtraBlock",value:function(){var e=this;this.extraBlocks.forEach(function(t){t.classList.add("hide"),t.classList.contains("advice__item_".concat(e.step+1))&&t.classList.remove("hide")})}},{key:"collectData",value:function(t){this.formData=$(this.form).serialize(),t.preventDefault(),$.magnificPopup.close(),this.onFinish()}}]),e}(),c=function(){function e(t){i(this,e),this.form=document.querySelector("#".concat(t.formID)),this.submitBtn=this.form.querySelector('[type="submit"]'),this.inputs=t.inputs,this.inputsCount=this.form.querySelectorAll(".inp-validate").length,this.validInputs=new Map,this.run()}return t(e,[{key:"run",value:function(){this.validate(),this.submit()}},{key:"validate",value:function(){var s=this;for(var t in this.inputs)!function(t){var i=s.inputs[t];s.form.querySelectorAll(".inp-validate input[type=".concat(i.type,"]")).forEach(function(t){var e=t.closest(".form__line");t.addEventListener("focus",function(){e.classList.remove("inp-error")}),"tel"===i.type?t.addEventListener("keyup",function(){console.log(t.value.indexOf("_")),-1===t.value.indexOf("_")?s.setInputOk(e):s.setInputError(e)}):t.addEventListener("keyup",function(){t.value.match(i.pattern)?s.setInputOk(e):s.setInputError(e)})})}(t)}},{key:"setInputOk",value:function(t){t.classList.add("inp-ok"),this.validInputs.set(t,null),this.checkValidInputsCount()}},{key:"setInputError",value:function(t){t.classList.remove("inp-ok"),this.validInputs.delete(t,null),this.checkValidInputsCount()}},{key:"checkValidInputsCount",value:function(){this.inputsCount==this.validInputs.size?this.submitBtn.classList.add("form-valid"):this.submitBtn.classList.remove("form-valid")}},{key:"submit",value:function(){var c=this;this.form.addEventListener("submit",function(t){var e,i,s,n,o;t.preventDefault(),c.submitBtn.classList.contains("form-valid")?(e=c.form,s=("quiz-form-final"===e.id?r.quiz.formData+"&":"")+$(e).serialize(),n=e.getAttribute("data-route"),o=e.querySelector("input.name"),r.clientName=o&&o.value,r.clientName&&(i=(i=r.clientName.toLowerCase().trim())[0].toUpperCase()+i.slice(1),document.querySelectorAll(".client-name").forEach(function(t){t.innerHTML=i+","})),$.ajax({url:"send.php",method:"POST",data:decodeURI(s),success:function(t){console.log("success"),console.log(t),dataLayer.push({event:"formsend",form_type:formThis.attr("class")})},error:function(t){alert("error - "+t.status)},complete:function(){console.log(this.data),n&&a("#".concat(n))}})):c.form.querySelectorAll(".inp-validate").forEach(function(t){t.classList.contains("inp-ok")||t.classList.add("inp-error")})})}}]),e}();