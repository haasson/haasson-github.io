"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}window.onload=function(){function t(){var o=document.querySelector(".process__active"),s=document.querySelectorAll(".license-calc__item");s.forEach(function(e,t,i){e.classList.remove("license-calc__item_active","license-calc__item_active-pulse");var n=t/s.length*100;setTimeout(function(){i[t-1]&&i[t-1].classList.remove("license-calc__item_active-pulse"),e.classList.add("license-calc__item_active","license-calc__item_active-pulse"),o.style.width="".concat(n,"%")},2e3*t),t===s.length-1&&setTimeout(function(){r("#after-quiz")},2e3*t+4e3)})}function n(){var e,t,i=c(document.querySelector(".quiz")).top;window.pageYOffset>i&&(t=(e=document.querySelector(".y-map")).getAttribute("data-src"),e.setAttribute("src",t),setTimeout(function(){ymaps.ready(function(){var e=new ymaps.Map("map-1",{center:[55.76713,37.6],zoom:17,behaviors:["drag"],controls:["zoomControl"]});document.documentElement.clientWidth<=992&&(e.behaviors.disable("drag"),e.behaviors.enable("multiTouch")),document.documentElement.clientWidth<=768&&e.setCenter([55.76713,37.60269]);var t=new ymaps.Placemark([55.76693,37.6022],{hintContent:"ЮрКомплекс Сити"},{iconLayout:"default#image",iconImageHref:"svg/single/placemark.svg",iconImageSize:[185,136],iconImageOffset:[-92,-40]});e.geoObjects.add(t)})},1e3),document.removeEventListener("scroll",n))}function i(){var e=c(document.querySelector(".header__hero")).top;window.pageYOffset>e&&(document.querySelectorAll(".license__img").forEach(function(e){var t=e.getAttribute("data-src");e.setAttribute("src",t)}),document.removeEventListener("scroll",i))}var o;svg4everybody(),function(){{if("function"==typeof NodeList.prototype.forEach)return;NodeList.prototype.forEach=Array.prototype.forEach}}(),new Swiper(".license__slider",{breakpoints:{1200:{slidesPerView:4},768:{slidesPerView:3},480:{slidesPerView:2}},slidesPerView:1,spaceBetween:30,pagination:{el:".swiper-pagination",clickable:!0}}),$(".license .popup-gallery").magnificPopup({type:"image",tLoading:"Loading image #%curr%...",mainClass:"custom-mfp",fixedContentPos:!0,fixedBgPos:!0,showCloseBtn:!0,delegate:".license__image",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image #%curr%</a> could not be loaded.'}}),$(".license .slider").magnificPopup({type:"image",tLoading:"Loading image #%curr%...",mainClass:"custom-mfp",fixedContentPos:!0,fixedBgPos:!0,showCloseBtn:!0,delegate:".license__link",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image #%curr%</a> could not be loaded.'}}),$(".popup-with-form").magnificPopup({type:"inline",preloader:!1,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,mainClass:"custom-mfp",callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(e){e.preventDefault(),$.magnificPopup.close()})},change:function(){window.scrollTo(0,c(this.container[0]).top),s.prevPopup=s.popupName,s.popupName=this.currItem.src},beforeClose:function(){"#policy"===this.currItem.src&&setTimeout(function(){r(s.prevPopup)},0)}}}),ouibounce(null,{aggressive:!0,callback:function(){r("#exit")}}),s.quiz=new a({quizSelector:"#quiz-block",extraBlocksClass:".advice__item",onFinish:function(){var e="#".concat(this.form.getAttribute("data-route"));setTimeout(function(){r(e,{open:t})},210)}}),document.querySelectorAll(".advice__play-btn").forEach(function(i){i.addEventListener("click",function(){var e=i.closest(".advice__video").querySelector("video"),t=e.getAttribute("data-src");e.setAttribute("src",t),e.play(),i.style.display="none",e.setAttribute("controls",!0)})}),document.querySelectorAll(".popup__provider").forEach(function(e){e.addEventListener("click",function(e){var t;"radio"===e.target.getAttribute("type")&&(t=e.target.closest("form").querySelector(".provider-text"),"Phone"===e.target.value?t.innerHTML="телефона":t.innerHTML="в ".concat(e.target.value))})}),document.addEventListener("scroll",n),document.addEventListener("scroll",i),i(),n(),o={phone:{type:"tel"},email:{pattern:/.+@.+\..+/i,type:"email"},name:{pattern:/^[а-яА-Я\s]{2,23}|[a-zA-Z\s]{2,30}$/,type:"text"}},["form-consult","form-exit","quiz-form-final","take-bonus-form","get-video-form"].forEach(function(e){new l({formID:e,inputs:o})}),$(".phone").mask("+7 999 999 9999",{autoclear:!1}),document.querySelector(".current-year").innerHTML=(new Date).getFullYear()},Element.prototype.closest||(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(this))return null;do{if(t.matches(e))return t;t=t.parentElement}while(null!==t);return null});var s={};function r(e,t){$.magnificPopup.open({type:"inline",mainClass:"custom-mfp",items:{src:e},preloader:!0,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(e){e.preventDefault(),$.magnificPopup.close()}),t&&t.open&&t.open()},change:function(){window.scrollTo(0,c(this.container[0]).top),s.prevPopup=s.popupName,s.popupName=this.currItem.src},beforeClose:function(){"#policy"===this.currItem.src&&setTimeout(function(){r(s.prevPopup)},0)}}},0)}function c(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}}var a=function(){function t(e){i(this,t),this.quiz=document.querySelector("".concat(e.quizSelector)),this.inPopup=e.inPopup,this.form=this.quiz.querySelector("form"),this.steps=this.quiz.querySelectorAll(".questions__item"),this.progressBar=this.quiz.querySelector(".questions__progress"),this.countCurrent=this.quiz.querySelector(".progress__count"),this.countTotal=this.quiz.querySelector(".progress__total"),this.prevBtn=this.quiz.querySelector(".questions__btn_prev"),this.nextBtn=this.quiz.querySelector(".questions__btn_next"),this.step=0,this.quizLength=this.steps.length,this.extraBlocks=this.quiz.querySelectorAll("".concat(e.extraBlocksClass)),this.finalForm=document.querySelector("#quiz-form-final"),this.takeBonusForm=document.querySelector("#take-bonus-form"),this.onFinish=e.onFinish,this.run()}return e(t,[{key:"run",value:function(){this.setEvents(),this.setStep(this.step)}},{key:"setEvents",value:function(){this.prevBtn.addEventListener("click",this.clickBtn.bind(this)),this.nextBtn.addEventListener("click",this.clickBtn.bind(this)),this.form.addEventListener("click",this.clickOnRadio.bind(this))}},{key:"clickBtn",value:function(e){e.target.classList.contains("questions__btn_prev")?this.setStep(this.step-1):this.setStep(this.step+1,e)}},{key:"clickOnRadio",value:function(e){var t=this;"radio"===e.target.getAttribute("type")&&setTimeout(function(){t.setStep(t.step+1,e)},200)}},{key:"setStep",value:function(e,t){var i=this;if(e>this.quizLength-1)return this.collectData(t),void setTimeout(function(){i.setStep(0)},200);this.step=e,this.showSlide(),this.setCount(),this.progressBar&&this.actualizeProgressBar(),this.extraBlocks.length&&this.showExtraBlock(),0!==e&&this.scrollTop()}},{key:"showSlide",value:function(){var t=this;this.steps.forEach(function(e){e.classList.contains("questions__item_".concat(t.step+1))?e.classList.remove("hide"):e.classList.add("hide")}),0===this.step?this.prevBtn.classList.add("hide"):this.prevBtn.classList.remove("hide")}},{key:"setCount",value:function(){this.totalSet||(this.countTotal.innerHTML=this.quizLength,this.totalSet=!0),this.countCurrent.innerHTML=this.step+1}},{key:"scrollTop",value:function(){var e=this.getCoords(this.progressBar).top;document.documentElement.clientWidth<=992&&window.scrollTo(0,e-30)}},{key:"getCoords",value:function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}}},{key:"actualizeProgressBar",value:function(){var e=this.progressBar.querySelector(".progress__active"),t=(this.step+1)/this.steps.length*100;e.style.width="".concat(t,"%")}},{key:"showExtraBlock",value:function(){var i=this;this.extraBlocks.forEach(function(e){var t=e.querySelector("video");e.classList.add("hide"),t&&t.pause(),e.classList.contains("advice__item_".concat(i.step+1))&&e.classList.remove("hide")})}},{key:"collectData",value:function(e){this.formData=$(this.form).serialize(),e.preventDefault(),$.magnificPopup.close(),this.onFinish()}}]),t}(),l=function(){function t(e){i(this,t),this.form=document.querySelector("#".concat(e.formID)),this.submitBtn=this.form.querySelector('[type="submit"]'),this.inputs=e.inputs,this.inputsCount=this.form.querySelectorAll(".inp-validate").length,this.validInputs=new Map,this.run()}return e(t,[{key:"run",value:function(){this.validate(),this.submit()}},{key:"validate",value:function(){var n=this;for(var e in this.inputs)!function(e){var i=n.inputs[e];n.form.querySelectorAll(".inp-validate input[type=".concat(i.type,"]")).forEach(function(e){var t=e.closest(".form__line");e.addEventListener("focus",function(){t.classList.remove("inp-error")}),"tel"===i.type?e.addEventListener("keyup",function(){console.log(e.value.indexOf("_")),-1===e.value.indexOf("_")?n.setInputOk(t):n.setInputError(t)}):e.addEventListener("keyup",function(){e.value.match(i.pattern)?n.setInputOk(t):n.setInputError(t)})})}(e)}},{key:"setInputOk",value:function(e){e.classList.add("inp-ok"),this.validInputs.set(e,null),this.checkValidInputsCount()}},{key:"setInputError",value:function(e){e.classList.remove("inp-ok"),this.validInputs.delete(e,null),this.checkValidInputsCount()}},{key:"checkValidInputsCount",value:function(){this.inputsCount==this.validInputs.size?this.submitBtn.classList.add("form-valid"):this.submitBtn.classList.remove("form-valid")}},{key:"submit",value:function(){var t=this;this.form.addEventListener("submit",function(e){e.preventDefault(),t.submitBtn.classList.contains("form-valid")?function(e){var t=("quiz-form-final"===e.id?s.quiz.formData+"&":"")+$(e).serialize();console.log(t);var i,n=e.getAttribute("data-route"),o=e.querySelector("input.name");s.clientName=o&&o.value,s.clientName&&(i=(i=s.clientName.toLowerCase().trim())[0].toUpperCase()+i.slice(1),document.querySelectorAll(".client-name").forEach(function(e){e.innerHTML=i+","})),$.ajax({url:"send.php",method:"POST",data:decodeURI(t),success:function(){console.log("success")},error:function(e){alert("error - "+e.status)},complete:function(){n&&r("#".concat(n))}})}(t.form):t.form.querySelectorAll(".inp-validate").forEach(function(e){e.classList.contains("inp-ok")||e.classList.add("inp-error")})})}}]),t}();