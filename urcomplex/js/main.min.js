"use strict";function o(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e){var t;$.magnificPopup.open({type:"inline",mainClass:"custom-mfp",items:{src:e},preloader:!0,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(e){e.preventDefault(),$.magnificPopup.close()})},change:function(){"#policy"!==this.currItem.src&&(t=this.currItem.src)},beforeClose:function(){var e=this;"#policy"===this.currItem.src&&setTimeout(function(){n(t)},0),"#consult"===this.currItem.src&&"quiz-block"===this.popupName&&setTimeout(function(){quiz.openPopup(e.popupName)},0)}}},0)}window.onload=function(){function e(e){e.preventDefault();var t=this,s=$(this).serialize(),i=this.querySelector("input.name");i&&(document.querySelector(".client-name").innerHTML=i.value),$.ajax({url:"send.php",method:"POST",data:decodeURI(s),success:function(e){console.log("success"),console.log(e),dataLayer.push({event:"formsend",form_type:formThis.attr("class")})},error:function(e){alert("error - "+e.status)},complete:function(){console.log(this.data),"form-exit"===t.id?n("#quiz-ty"):n("#consult-ty")}})}var t,s;new Swiper(".license__slider",{breakpoints:{1200:{slidesPerView:4},768:{slidesPerView:3},480:{slidesPerView:2}},slidesPerView:1,spaceBetween:30,pagination:{el:".swiper-pagination",clickable:!0}}),$(".license .popup-gallery").magnificPopup({type:"image",tLoading:"Loading image #%curr%...",mainClass:"custom-mfp",fixedContentPos:!0,fixedBgPos:!0,showCloseBtn:!0,delegate:".license__image",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image #%curr%</a> could not be loaded.'}}),$(".popup-with-form").magnificPopup({type:"inline",preloader:!1,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,mainClass:"custom-mfp",callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(e){e.preventDefault(),$.magnificPopup.close()})},change:function(){"#policy"!==this.currItem.src&&(this.prevPopup=this.popupName,this.popupName=this.currItem.src)},beforeClose:function(){var e=this;"#policy"===this.currItem.src&&setTimeout(function(){n(e.popupName)},0),"#consult"===this.currItem.src&&"#quiz-block"===this.prevPopup&&setTimeout(function(){n(e.prevPopup)},0)}}}),ymaps.ready(function(){var e=new ymaps.Map("map-1",{center:[55.76713,37.6],zoom:17,behaviors:["drag"],controls:["zoomControl"]});document.documentElement.clientWidth<=992&&(e.behaviors.disable("drag"),e.behaviors.enable("multiTouch")),document.documentElement.clientWidth<=768&&e.setCenter([55.76713,37.60269]);var t=new ymaps.Placemark([55.76693,37.6022],{hintContent:"ЮрКомплекс Сити"},{iconLayout:"default#image",iconImageHref:"svg/single/placemark.svg",iconImageSize:[185,136],iconImageOffset:[-92,-40]});e.geoObjects.add(t)}),t=document.querySelector("#form-consult"),s=document.querySelector("#form-exit"),t.addEventListener("submit",e),s.addEventListener("submit",e),ouibounce(null,{aggressive:!0,callback:function(){n("#exit")}}),new i({quizSelector:"#quiz-block",extraBlocksClass:".advice__item"}),$(".phone").mask("+7 999 999 9999",{autoclear:!1})};var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.quiz=document.querySelector("".concat(e.quizSelector)),this.inPopup=e.inPopup,this.form=this.quiz.querySelector("form"),this.steps=this.quiz.querySelectorAll(".questions__item"),this.progressBar=this.quiz.querySelector(".questions__progress"),this.countCurrent=this.quiz.querySelector(".progress__count"),this.countTotal=this.quiz.querySelector(".progress__total"),this.prevBtn=this.quiz.querySelector(".questions__btn_prev"),this.nextBtn=this.quiz.querySelector(".questions__btn_next"),this.step=0,this.quizLength=this.steps.length,this.extraBlocks=this.quiz.querySelectorAll("".concat(e.extraBlocksClass)),this.finalForm=document.querySelector("#quiz-form-final"),this.takeBonusForm=document.querySelector("#take-bonus-form"),this.run()}var e,s,i;return e=t,(s=[{key:"run",value:function(){this.setEvents(),this.setStep(this.step)}},{key:"setEvents",value:function(){this.prevBtn.addEventListener("click",this.clickBtn.bind(this)),this.nextBtn.addEventListener("click",this.clickBtn.bind(this)),this.finalForm.addEventListener("submit",this.submitForm.bind(this)),this.takeBonusForm.addEventListener("submit",this.submitTakeBonus.bind(this))}},{key:"clickBtn",value:function(e){e.target.classList.contains("questions__btn_prev")?this.setStep(this.step-1):this.setStep(this.step+1,e)}},{key:"setStep",value:function(e,t){if(console.log(e),console.log(this.quizLength-1),0!==e&&this.scrollTop(),e>this.quizLength-1)return this.collectData(t),void this.setStep(0);this.step=e,this.showSlide(),this.setCount(),this.progressBar&&this.actualizeProgressBar(),this.extraBlocks.length&&this.showExtraBlock()}},{key:"showSlide",value:function(){var t=this;this.steps.forEach(function(e){e.classList.add("hide"),e.classList.contains("questions__item_".concat(t.step+1))&&e.classList.remove("hide")}),0===this.step?this.prevBtn.classList.add("hide"):this.prevBtn.classList.remove("hide")}},{key:"setCount",value:function(){this.totalSet||(this.countTotal.innerHTML=this.quizLength,this.totalSet=!0),this.countCurrent.innerHTML=this.step+1}},{key:"scrollTop",value:function(){var e=this.getCoords(this.progressBar).top;document.documentElement.clientWidth<=992&&window.scrollTo(0,e-30)}},{key:"getCoords",value:function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}}},{key:"actualizeProgressBar",value:function(){var e=this.progressBar.querySelector(".progress__active"),t=(this.step+1)/this.steps.length*100;e.style.width="".concat(t,"%")}},{key:"showExtraBlock",value:function(){var t=this;this.extraBlocks.forEach(function(e){e.classList.add("hide"),e.classList.contains("advice__item_".concat(t.step+1))&&e.classList.remove("hide")})}},{key:"collectData",value:function(e){var t=this,s="#".concat(this.form.getAttribute("data-route"));this.formData1=$(this.form).serialize(),e.preventDefault(),$.magnificPopup.close(),setTimeout(function(){t.openPopup(s,!0)},210)}},{key:"submitForm",value:function(e){e.preventDefault();var t=this,s=this.formData1+"&"+$(this.finalForm).serialize();$.ajax({url:"send.php",method:"POST",data:decodeURI(s),success:function(e){console.log("success"),console.log(e),dataLayer.push({event:"formsend",form_type:formThis.attr("class")})},error:function(e){alert("error - "+e.status)},complete:function(){console.log(this.data),t.openPopup("#take-bonus")}})}},{key:"submitTakeBonus",value:function(e){e.preventDefault();var t=this,s=$(this.takeBonusForm).serialize(),i=this.takeBonusForm.querySelector("input.name").value;document.querySelector(".quiz-ty__client").innerHTML=" ".concat(i,","),$.ajax({url:"send.php",method:"POST",data:decodeURI(s),success:function(e){console.log("success"),console.log(e),dataLayer.push({event:"formsend",form_type:formThis.attr("class")})},error:function(e){alert("error - "+e.status)},complete:function(){console.log(this.data),t.openPopup("#quiz-ty")}})}},{key:"openPopup",value:function(e,t){var s=this;$.magnificPopup.open({type:"inline",mainClass:"custom-mfp custom-mfp-form",items:{src:"".concat(e)},preloader:!0,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(e){e.preventDefault(),$.magnificPopup.close()}),t&&s.fakeLicenseCalc()},change:function(){"#policy"!==this.currItem.src&&(this.popupName=this.currItem.src)},beforeClose:function(){var e=this;"#policy"===this.currItem.src&&setTimeout(function(){s.openPopup(e.popupName)},0)}}},0)}},{key:"fakeLicenseCalc",value:function(){var o=this,n=document.querySelector(".process__active"),c=document.querySelectorAll(".license-calc__item");c.forEach(function(e,t,s){e.classList.remove("license-calc__item_active","license-calc__item_active-pulse");var i=t/c.length*100;setTimeout(function(){s[t-1]&&s[t-1].classList.remove("license-calc__item_active-pulse"),e.classList.add("license-calc__item_active","license-calc__item_active-pulse"),n.style.width="".concat(i,"%")},3e3*t),t===c.length-1&&setTimeout(function(){o.openPopup("#after-quiz")},3e3*t+5e3)})}}])&&o(e.prototype,s),i&&o(e,i),t}();