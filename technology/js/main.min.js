"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}window.onload=function(){var e,t,o,n,i,s,c,r,a,l;function u(e){e.classList.remove("advantages__item_collapse")}console.log(this),document.body.classList.remove("loading"),svg4everybody(),function(){{if("function"==typeof NodeList.prototype.forEach)return;NodeList.prototype.forEach=Array.prototype.forEach}}(),document.body.classList.contains("main-page")?($(".select2").select2({minimumResultsForSearch:1/0,containerCssClass:"custom-select",dropdownCssClass:"custom-dropdown"}),new Swiper(".complex__slider",{autoHeight:!0,breakpoints:{1200:{slidesPerView:3,spaceBetween:30},992:{slidesPerView:2,spaceBetween:50},768:{slidesPerView:2,spaceBetween:40},568:{slidesPerView:1,spaceBetween:30},480:{slidesPerView:1,spaceBetween:20}},watchOverflow:!0,slidesPerView:1,spaceBetween:20,pagination:{el:".swiper-pagination",clickable:!0}}),ymaps.ready(function(){var e=new ymaps.Map("map",{center:[55.9005,37.53],zoom:16,behaviors:["drag"],controls:["zoomControl"]});document.documentElement.clientWidth<=1300&&e.setCenter([55.900958,37.535035]),document.documentElement.clientWidth<=992&&(e.setCenter([55.902,37.54]),e.behaviors.disable("drag"),e.behaviors.enable("multiTouch"));var t=new ymaps.Placemark([55.90079,37.5405],{hintContent:"Технология"},{iconLayout:"default#image",iconImageHref:"svg/single/placemark.svg",iconImageSize:[58,64],iconImageOffset:[-29,-32]});e.geoObjects.add(t)}),t=document.querySelector(".form__cities"),o=t.closest("form").querySelector("input[name=city]"),t.addEventListener("click",function(e){var t=e.target.closest(".form__city").innerHTML;o.value=t}),document.querySelectorAll(".j-show-more").forEach(function(e){e.addEventListener("click",function(){e.closest(".advantages__list").querySelectorAll(".advantages__item_collapse").forEach(u),e.closest(".advantages__more").classList.add("hide")})})):(e=localStorage.getItem("tyText"),console.log(e),e&&(console.log("here"),document.querySelector(".success__text").innerHTML=e,localStorage.removeItem("tyText"))),$(".popup-default").magnificPopup({type:"inline",preloader:!1,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,mainClass:"custom-mfp",callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(e){e.preventDefault(),$.magnificPopup.close()})},change:function(){console.log("change"),window.scrollTo(0,m(this.container[0]).top),p.prevPopup=p.popupName,p.popupName=this.currItem.src},beforeClose:function(){}}}),function(){document.querySelector("#form-quiz")&&new f({formSelector:"#form-quiz",tooltips:!0,endpoints:!0});document.querySelector("#form-calc")&&new f({formSelector:"#form-calc",tooltips:!0,endpoints:!0,additionalTooltip:!0})}(),n=document.querySelectorAll("form"),i={phone:{type:"tel"},email:{pattern:/.+@.+\..+/i,type:"email"},name:{pattern:/^[а-яА-Я\s]{2,23}|[a-zA-Z\s]{2,30}$/,type:"text"}},n.forEach(function(e){new h({form:e,inputs:i,onSubmit:d})}),function(){var e=document.querySelectorAll(".tabs");if(!e.length)return;e.forEach(function(i){var s=i.parentElement,c=s.querySelectorAll(".tabs-content");i.addEventListener("click",function(e){var t=e.target.closest(".tabs-button"),o=t.getAttribute("data-tabs"),n=s.querySelector("#tab-".concat(o));i.querySelectorAll(".tabs-button").forEach(function(e){e.classList.remove("tabs-active")}),t.classList.add("tabs-active"),c.forEach(function(e){e.classList.add("hide")}),n.classList.remove("hide")})})}(),s=document.querySelectorAll(".play-btn"),console.log(s),s.forEach(function(o){console.log("click"),o.addEventListener("click",function(){var e=o.closest(".video-wrap").querySelector("video"),t=e.getAttribute("data-src");e.setAttribute("src",t),e.play(),o.style.display="none",e.setAttribute("controls",!0)})}),c=document.querySelector(".p-callback__form"),r=c.querySelector(".form__call-time"),a=c.querySelector("#time-now"),l=c.querySelector("#time-later"),r.addEventListener("focus",function(){a.removeAttribute("checked"),l.setAttribute("checked",!0)}),r.addEventListener("blur",function(){""===r.value&&(l.removeAttribute("checked"),a.setAttribute("checked",!0))}),$("input[type=tel]").mask("+7 999 999 9999",{autoclear:!1}),document.querySelector(".current-year").innerHTML=(new Date).getFullYear()};var p={};function d(e){var t=e.getAttribute("data-popup"),o=e.getAttribute("data-route");if("form-quiz"===e.id||"form-calc"===e.id)return p.formData=$(e).serialize(),void i("#".concat(t),{open:s});var n=("form-p-choosing"===e.id?p.formData+"&":"")+$(e).serialize();!function(e){var t;"form-p-callback"===e||"form-consult"===e||"form-p-testdrive"===e?t="Мы получили вашу заявку и в скором времени вам позвоним":"form-p-choosing"===e?t="Мы получили вашу заявку и в скором времени пришлём вам подбор оборудования и расчет окупаемости":"form-p-leasing"===e?t="Мы получили вашу заявку и в скором времени пришлём вам комплект документов":"form-tradein"===e&&(t="Мы получили вашу заявку и в скором времени пришлём вам расчет стоимости оборудования");t&&localStorage.setItem("tyText",t)}(e.id),$.ajax({url:"send.php",method:"POST",data:decodeURI(n),success:function(e){console.log("success"),console.log(e)},error:function(e){alert("error - "+e.status)},complete:function(){console.log(this.data),p.formData=null,t&&i("#".concat(t)),o&&(window.location="./".concat(o,".html"))}})}function i(e,t){$.magnificPopup.open({type:"inline",mainClass:"custom-mfp",items:{src:e},preloader:!0,showCloseBtn:!1,fixedContentPos:!0,fixedBgPos:!0,callbacks:{open:function(){$(".p-close, .close-popup").on("click",function(e){e.preventDefault(),$.magnificPopup.close()}),t&&t.open&&t.open()},change:function(){window.scrollTo(0,m(this.container[0]).top),p.prevPopup=p.popupName,p.popupName=this.currItem.src},beforeClose:function(){"#policy"===this.currItem.src&&setTimeout(function(){i(p.prevPopup)},0)}}},0)}function s(){var e=document.querySelector(".p-choosing"),c=e.querySelector(".p-choosing__first"),r=e.querySelector(".p-choosing__second"),a=e.querySelector(".progress__active"),l=e.querySelector(".progress__point"),u=e.querySelector(".progress-value"),t=document.querySelectorAll(".content__item"),p=100/t.length;!function e(t,o){var n=t[o];var i=o===t.length-1;var s=Math.ceil((o+1)*p);0===o&&(t.forEach(function(e){e.classList.remove("content__item_active","content__item_done"),a.style.width=0,l.style.left=0,u.innerHTML="0%"}),c.classList.remove("hide"),r.classList.add("hide"));n.classList.add("content__item_active");setTimeout(function(){i?(c.classList.add("hide"),r.classList.remove("hide")):(n.classList.remove("content__item_active"),n.classList.add("content__item_done"),a.style.width="".concat(s,"%"),l.style.left=0===s?"0px":"calc(".concat(s,"% - 23px)"),u.innerHTML="".concat(s,"%"),e(t,o+1))},i?4e3:2e3)}(t,0)}function m(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}}Element.prototype.closest||(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(this))return null;do{if(t.matches(e))return t;t=t.parentElement}while(null!==t);return null});var f=function(){function t(e){o(this,t),this.form=document.querySelector(e.formSelector),this.tooltips=e.tooltips||!1,this.decimals=e.decimals||0,this.endpoints=e.endpoints,this.additionalTooltip=e.additionalTooltip,this.run()}return e(t,[{key:"run",value:function(){this.createRange()}},{key:"createRange",value:function(){var a=this;this.form.querySelectorAll("input[type=range]").forEach(function(t){var e=t.getAttribute("name"),o=+t.getAttribute("min"),n=+t.getAttribute("max"),i=+t.getAttribute("value"),s=+t.getAttribute("step"),c=t.getAttribute("class"),r=document.createElement("div");r.classList.add(c,"".concat(c,"_").concat(e)),t.insertAdjacentHTML("afterend",r.outerHTML),t.classList.add("hide"),a.additionalTooltip&&a.setAdditionalValue(t,i),noUiSlider.create(a.form.querySelector(".".concat(c,"_").concat(e)),{start:i,range:{min:[o],max:[n]},step:s,tooltips:a.tooltips,format:wNumb({decimals:a.decimals,thousand:" "})}).on("change",function(e){t.setAttribute("value",e[0]),a.additionalTooltip&&a.setAdditionalValue(t,e[0])}),a.endpoints&&a.addEndpoint(t,o,n)})}},{key:"addEndpoint",value:function(e,t,o){var n=e.closest(".form__input").querySelectorAll(".form__input-endpoint"),i=wNumb({thousand:" "});n.forEach(function(e){e.classList.contains("start")?e.innerHTML=i.to(t):e.classList.contains("end")&&(e.innerHTML=i.to(o))})}},{key:"setAdditionalValue",value:function(e,t){e.closest(".form__input").querySelector(".form__range-table").innerHTML=t}}]),t}(),h=function(){function t(e){o(this,t),this.form=e.form,this.submitBtn=this.form.querySelector('[type="submit"]'),this.onSubmit=e.onSubmit,this.inputs=e.inputs,this.inputsCount=0,this.validInputs=new Map,this.run()}return e(t,[{key:"run",value:function(){this.validate(),this.submit()}},{key:"validate",value:function(){var n=this;for(var e in this.inputs)!function(e){var o=n.inputs[e],t=n.form.querySelectorAll(".input:not(.no-validate) input[type=".concat(o.type,"]"));n.inputsCount+=t.length,t.forEach(function(e){var t=e.closest(".input");e.addEventListener("focus",function(){t.classList.remove("inp-error")}),"tel"===o.type?e.addEventListener("keyup",function(){-1===e.value.indexOf("_")?n.setInputOk(t):n.setInputError(t)}):e.addEventListener("keyup",function(){e.value.match(o.pattern)?n.setInputOk(t):n.setInputError(t)})})}(e)}},{key:"setInputOk",value:function(e){e.classList.add("inp-ok"),this.validInputs.set(e,null),this.checkValidInputsCount()}},{key:"setInputError",value:function(e){e.classList.remove("inp-ok"),this.validInputs.delete(e,null),this.checkValidInputsCount()}},{key:"checkValidInputsCount",value:function(){this.inputsCount==this.validInputs.size?this.submitBtn.classList.add("form-valid"):this.submitBtn.classList.remove("form-valid")}},{key:"submit",value:function(){var t=this;this.form.addEventListener("submit",function(e){e.preventDefault(),t.submitBtn.classList.contains("form-valid")||0===t.inputsCount?t.onSubmit(t.form):t.form.querySelectorAll(".input:not(.no-validate)").forEach(function(e){e.classList.contains("inp-ok")||e.classList.add("inp-error")})})}}]),t}();